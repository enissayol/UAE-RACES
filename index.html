<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAE Running Events Calendar</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #0e2a38 0%, #2d586e 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .auto-update-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-active {
            background-color: #28a745;
        }
        
        .status-inactive {
            background-color: #dc3545;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        select {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            font-size: 16px;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 12px 20px;
            background: #2d586e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #1e3e50;
        }
        
        .export-btn {
            background: #28a745;
        }
        
        .export-btn:hover {
            background: #218838;
        }
        
        .load-btn {
            background: #17a2b8;
        }
        
        .load-btn:hover {
            background: #138496;
        }
        
        .auto-update-btn {
            background: #6f42c1;
        }
        
        .auto-update-btn:hover {
            background: #5a359c;
        }
        
        .auto-update-btn.active {
            background: #28a745;
        }
        
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #2d586e;
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f7fb;
        }
        
        .event-name {
            font-weight: 600;
            color: #2d586e;
        }
        
        .category {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .category-elite {
            background: #ffeeba;
            color: #856404;
        }
        
        .category-community {
            background: #c3e6cb;
            color: #155724;
        }
        
        .category-trail {
            background: #b8daff;
            color: #004085;
        }
        
        .price {
            font-weight: 600;
            color: #28a745;
        }
        
        .registration-link a {
            color: #2d586e;
            text-decoration: none;
            font-weight: 600;
        }
        
        .registration-link a:hover {
            text-decoration: underline;
        }
        
        .json-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .json-container h3 {
            margin-bottom: 15px;
            color: #2d586e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .json-content {
            background: #f8f9fa;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2d586e;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #6c757d;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .buttons {
                width: 100%;
                justify-content: center;
            }
            
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>UAE Running Events Calendar</h1>
            <p class="subtitle">Find and filter running events in the UAE from November 2025 to March 2026</p>
            <div class="auto-update-status">
                <span class="status-indicator" id="status-indicator"></span>
                <span id="update-status">Auto-update: Inactive</span>
                <span id="last-updated"></span>
            </div>
        </header>
        
        <div class="controls">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search events...">
            </div>
            
            <div class="filter-group">
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <option value="elite">Elite</option>
                    <option value="community">Community</option>
                    <option value="trail">Trail/Ultra</option>
                </select>
                
                <select id="month-filter">
                    <option value="">All Months</option>
                    <option value="11">November 2025</option>
                    <option value="12">December 2025</option>
                    <option value="1">January 2026</option>
                    <option value="2">February 2026</option>
                    <option value="3">March 2026</option>
                </select>
            </div>
            
            <div class="buttons">
                <button id="reset-btn">Reset Filters</button>
                <button id="load-json-btn" class="load-btn">Load Data</button>
                <button id="auto-update-btn" class="auto-update-btn">Enable Auto-Update</button>
                <button id="export-btn" class="export-btn">Export to JSON</button>
            </div>
        </div>
        
        <div class="table-container">
            <table id="events-table">
                <thead>
                    <tr>
                        <th>Event Name</th>
                        <th>Date</th>
                        <th>Distance(s)</th>
                        <th>Location</th>
                        <th>Category</th>
                        <th>Price (AED)</th>
                        <th>Early Bird</th>
                        <th>Registration</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="8" class="loading">
                            <div class="spinner"></div>
                            <span>Loading events data...</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="json-container">
            <h3>
                JSON Data
                <button id="toggle-json-btn">Show/Hide</button>
            </h3>
            <div class="json-content" id="json-content" style="display: none;">
                {/* JSON data will be displayed here */}
            </div>
        </div>
        
        <div class="notification" id="notification">
            Data loaded successfully!
        </div>
        
        <footer>
            <p>Data sourced from Premier Online, Hopasports, and various race organizers</p>
            <p>© 2025 UAE Running Events Calendar - Auto-updating every 5 minutes</p>
        </footer>
    </div>

    <script>
        // Global variables
        let eventsData = [];
        let autoUpdateInterval = null;
        let isAutoUpdateEnabled = false;
        
        // GitHub Pages JSON URL (update with your actual repository details)
        const JSON_FILE_URL = 'data/uae_running_events.json';

        // Function to show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.remove('error');
            
            if (isError) {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Function to update status indicator
        function updateStatusIndicator() {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('update-status');
            
            if (isAutoUpdateEnabled) {
                indicator.className = 'status-indicator status-active';
                statusText.textContent = 'Auto-update: Active (every 5 min)';
            } else {
                indicator.className = 'status-indicator status-inactive';
                statusText.textContent = 'Auto-update: Inactive';
            }
        }

        // Function to update last updated timestamp
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('last-updated').textContent = `Last updated: ${timeString}`;
        }

        // Function to fetch JSON data from GitHub
        async function fetchJSONData() {
            try {
                // Show loading state
                const tbody = document.querySelector('#events-table tbody');
                tbody.innerHTML = '<tr><td colspan="8" class="loading"><div class="spinner"></div><span>Loading events data...</span></td></tr>';
                
                // Add timestamp to URL to prevent caching
                const response = await fetch(`${JSON_FILE_URL}?t=${new Date().getTime()}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check if data is in the expected format
                if (!Array.isArray(data)) {
                    throw new Error('Invalid JSON format: Expected an array of events');
                }
                
                return data;
            } catch (error) {
                console.error('Error fetching JSON data:', error);
                showNotification('Error loading data. Using fallback data.', true);
                
                // Return fallback data if external fetch fails
                return getFallbackData();
            }
        }

        // Fallback data in case JSON file is not available
        function getFallbackData() {
            return [
                {
                    name: "NBF Fujairah Run",
                    date: "22/11/2025",
                    distances: "11km Trail, 10km, 5km, 3km Road",
                    location: "Fujairah",
                    category: "trail",
                    price: "TBA",
                    earlyBird: "Not specified",
                    registrationLink: "https://www.premieronline.com/event/nbf-fujairah-run",
                    source: "Premier Online"
                },
                {
                    name: "Community Run @ The Ripe Market | 2",
                    date: "14/12/2025",
                    distances: "15km, 10km, 5km, 2.5km",
                    location: "The Ripe Market, Dubai Police Academy",
                    category: "community",
                    price: "156 (15km), 137 (10km), 126 (5km), 116 (2.5km)",
                    earlyBird: "No",
                    registrationLink: "https://www.hopasports.com/en/event/community-run-the-ripe-market-2",
                    source: "Hopasports"
                },
                {
                    name: "Umm Al Quwain Half Marathon 2026",
                    date: "11/01/2026",
                    distances: "Half Marathon (21.1km), 10km, 5km, 1 Mile",
                    location: "Vida Beach Resort, Umm Al Quwain",
                    category: "elite",
                    price: "From 50 (1M) to 145 (HM)",
                    earlyBird: "Yes (Until 15/04/2026)",
                    registrationLink: "https://www.hopasports.com/en/event/umm-al-quwain-half-marathon-2026",
                    source: "Hopasports"
                },
                {
                    name: "NAS Sports Tournament - Running Race",
                    date: "08/03/2025",
                    distances: "10km, 5km, 4km",
                    location: "Meydan Racecourse, Dubai",
                    category: "elite",
                    price: "TBA",
                    earlyBird: "Not specified",
                    registrationLink: "https://registration.nasst.ae/",
                    source: "NAS Sports"
                }
            ];
        }

        // Load JSON data from GitHub
        async function loadJSONData() {
            eventsData = await fetchJSONData();
            populateTable(eventsData);
            updateJSONDisplay(eventsData);
            updateLastUpdated();
            showNotification('Data loaded successfully!');
        }

        // Populate the table with data
        function populateTable(events) {
            const tbody = document.querySelector('#events-table tbody');
            
            // Clear loading state
            tbody.innerHTML = '';
            
            if (!events || events.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" style="text-align: center;">No events found matching your criteria</td>`;
                tbody.appendChild(row);
                return;
            }
            
            events.forEach(event => {
                const row = document.createElement('tr');
                
                // Determine category class
                let categoryClass = '';
                let categoryText = '';
                switch(event.category) {
                    case 'elite':
                        categoryClass = 'category-elite';
                        categoryText = 'Elite';
                        break;
                    case 'community':
                        categoryClass = 'category-community';
                        categoryText = 'Community';
                        break;
                    case 'trail':
                        categoryClass = 'category-trail';
                        categoryText = 'Trail/Ultra';
                        break;
                    default:
                        categoryClass = '';
                        categoryText = event.category || 'Unknown';
                }
                
                row.innerHTML = `
                    <td class="event-name">${event.name || 'N/A'}</td>
                    <td>${event.date || 'N/A'}</td>
                    <td>${event.distances || 'N/A'}</td>
                    <td>${event.location || 'N/A'}</td>
                    <td><span class="category ${categoryClass}">${categoryText}</span></td>
                    <td class="price">${event.price || 'TBA'}</td>
                    <td>${event.earlyBird || 'Not specified'}</td>
                    <td class="registration-link"><a href="${event.registrationLink || '#'}" target="_blank">Register</a></td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update JSON display
        function updateJSONDisplay(events) {
            const jsonContent = document.getElementById('json-content');
            jsonContent.textContent = JSON.stringify(events, null, 2);
        }

        // Filter events based on search and filters
        function filterEvents() {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const monthFilter = document.getElementById('month-filter').value;
            
            const filteredEvents = eventsData.filter(event => {
                // Search text filter
                const matchesSearch = 
                    (event.name && event.name.toLowerCase().includes(searchText)) ||
                    (event.location && event.location.toLowerCase().includes(searchText)) ||
                    (event.distances && event.distances.toLowerCase().includes(searchText));
                
                // Category filter
                const matchesCategory = categoryFilter === '' || event.category === categoryFilter;
                
                // Month filter
                let matchesMonth = true;
                if (monthFilter !== '' && event.date) {
                    const eventMonth = event.date.split('/')[1]; // Get month part from DD/MM/YYYY
                    matchesMonth = eventMonth === monthFilter;
                }
                
                return matchesSearch && matchesCategory && matchesMonth;
            });
            
            populateTable(filteredEvents);
            updateJSONDisplay(filteredEvents);
        }

        // Export to JSON functionality
        function exportToJSON() {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const monthFilter = document.getElementById('month-filter').value;
            
            // Get filtered events for export
            const filteredEvents = eventsData.filter(event => {
                const matchesSearch = 
                    (event.name && event.name.toLowerCase().includes(searchText)) ||
                    (event.location && event.location.toLowerCase().includes(searchText)) ||
                    (event.distances && event.distances.toLowerCase().includes(searchText));
                
                const matchesCategory = categoryFilter === '' || event.category === categoryFilter;
                
                let matchesMonth = true;
                if (monthFilter !== '' && event.date) {
                    const eventMonth = event.date.split('/')[1];
                    matchesMonth = eventMonth === monthFilter;
                }
                
                return matchesSearch && matchesCategory && matchesMonth;
            });
            
            const dataStr = JSON.stringify(filteredEvents, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'uae_running_events_export.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Data exported successfully!');
        }

        // Toggle auto-update functionality
        function toggleAutoUpdate() {
            const autoUpdateBtn = document.getElementById('auto-update-btn');
            
            if (isAutoUpdateEnabled) {
                // Disable auto-update
                clearInterval(autoUpdateInterval);
                isAutoUpdateEnabled = false;
                autoUpdateBtn.textContent = 'Enable Auto-Update';
                autoUpdateBtn.classList.remove('active');
                showNotification('Auto-update disabled');
            } else {
                // Enable auto-update
                isAutoUpdateEnabled = true;
                autoUpdateBtn.textContent = 'Disable Auto-Update';
                autoUpdateBtn.classList.add('active');
                
                // Check for updates every 5 minutes
                autoUpdateInterval = setInterval(async () => {
                    const newData = await fetchJSONData();
                    
                    // Only update if data has changed
                    if (JSON.stringify(newData) !== JSON.stringify(eventsData)) {
                        eventsData = newData;
                        filterEvents(); // This will re-apply current filters
                        updateLastUpdated();
                        showNotification('Data updated automatically!');
                    }
                }, 300000); // 5 minutes = 300,000 milliseconds
                
                showNotification('Auto-update enabled (every 5 minutes)');
            }
            
            updateStatusIndicator();
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async () => {
            // Wait for DOM to be fully ready before loading data
            setTimeout(async () => {
                // Load data initially
                await loadJSONData();
                
                // Add event listeners
                document.getElementById('search-input').addEventListener('input', filterEvents);
                document.getElementById('category-filter').addEventListener('change', filterEvents);
                document.getElementById('month-filter').addEventListener('change', filterEvents);
                
                document.getElementById('reset-btn').addEventListener('click', () => {
                    document.getElementById('search-input').value = '';
                    document.getElementById('category-filter').value = '';
                    document.getElementById('month-filter').value = '';
                    populateTable(eventsData);
                    updateJSONDisplay(eventsData);
                });
                
                document.getElementById('export-btn').addEventListener('click', exportToJSON);
                document.getElementById('load-json-btn').addEventListener('click', loadJSONData);
                document.getElementById('auto-update-btn').addEventListener('click', toggleAutoUpdate);
                
                document.getElementById('toggle-json-btn').addEventListener('click', () => {
                    const jsonContent = document.getElementById('json-content');
                    if (jsonContent.style.display === 'none') {
                        jsonContent.style.display = 'block';
                        document.getElementById('toggle-json-btn').textContent = 'Hide JSON';
                    } else {
                        jsonContent.style.display = 'none';
                        document.getElementById('toggle-json-btn').textContent = 'Show JSON';
                    }
                });
                
                // Initialize status indicator
                updateStatusIndicator();
            }, 100); // Small delay to ensure DOM is fully ready
        });
    </script>
</body>
</html>
